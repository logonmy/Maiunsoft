<script>
function edit_category(id) {
    $.post(
        "{:U('category/edit')}", {
            'id': id
        },
        function(data) 
        {
        	if(!data){
        		alert('没有找到您要修改的数据');
        		return;
        	}else{
        		$("#editCategoryModal button[name='category_id']").val(data['id']);
        		$("#editCategoryModal input[name='category_name']").val(data['name']);
        		$("#editCategoryModal textarea[name='category_bref']").val(data['bref']);
        		$("#editCategoryModal select[name='category_type'] option").eq(data['type']).attr("selected",true);

        		$("#editCategoryModal .modal-title").html('修改目录信息');
        		$("#editCategoryModal").modal(); 
        	}
        });
}

function del_category(id) {
    location.href = '__URL__/delete/id/' + id;
}

function change_category(id) {
    location.href = '__URL__/change_status/id/' + id;
}

$(document).ready(function(){

    // 选择不同的库，显示相应的库存信息
    $("#typeSelector").change(function(){
        var url = "{:U('category/admin')}?type=" + $("#typeSelector").val();
        window.location.href = url;
    });

    $("#addCategoryBtn").click(function(){
    	$("#editCategoryModal .modal-title").html('新建目录');
    	$("#editCategoryModal input").val(null);
    	$("#editCategoryModal textarea").val(null);
        $("#editCategoryModal").modal();  
    });
});
</script>

<section class="col-lg-12">
	<ul class="panel-tab">
		<li>
			<tagLib name="html" />
			<html:select name="type" title="type" options="typeList" selected="type" id="typeSelector"/>
		</li>
		<a class="pull-right fa fa-plus create-btn" id="addCategoryBtn">&nbsp;新建目录</a>
	</ul>
	<html:grid id="categoryListTable" datasource="categoryList" key="true" pk="id" show="name:名称" style="table table-advance table-hover" action="true" actionList="edit_category:编辑,del_category:删除" />
</section>

<!-- 编辑门店 -->
<div class="modal" id="editCategoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content" style="width:600px;">
			<form action="{:U('category/save')}" method="post">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">
						<span aria-hidden="true">&times;</span>
						<span class="sr-only">关闭</span>
					</button>
					<h4 class="modal-title">编辑门店</h4>
				</div>
				<div class="modal-body" style="overflow:auto;">
					<div class="col-lg-12">
						<div class="form-group">
							<label>
								目录名称
							</label>
							<input name="category_name" value="{$category.name}" required="required" maxlength="20" class="form-control" />
						</div>
						<div class="form-group">
							<label>
								目录类型
							</label>
							<html:select name="category_type" title="type" options="typeList" selected="type" style="form-control"/>
						</div>
						<div class="form-group">
							<label>
								目录名称
							</label>
							<textarea class="form-control" name="category_bref"></textarea>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<div class="col-lg-12">
						<button type="submit" class="btn btn-danger" name="category_id" value="">保存</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>