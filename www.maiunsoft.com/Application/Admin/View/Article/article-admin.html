<style type="text/css">
    .edui-editor{
        width: 100%;
        height: 100%;
    }
</style>

<script>
function delete_article(id) {
    location.href = '__URL__/delete/id/' + id;
}

function edit_article (id) {
    $.get(
        "{:U('article/edit')}", {
            'id': id
        },
        function(data) 
        {
            if(data==0){
                alert('没有找到您要修改的数据');
                return;
            }else{
                $("#editArticleModal button[name='article_id']").val(data['id']);
                $("#editArticleModal input[name='article_title']").val(data['title']);
                $("#editArticleModal input[name='article_author']").val(data['author']);
                $("#editArticleModal textarea[name='article_bref']").val(data['bref']);
                $("#editArticleModal input[name='article_reference']").val(data['reference']);
                $("#editArticleModal input[name='article_group']").val(data['group_id']);

                var logo = "{:UploadUrl('article')}"+data['id']+'/'+data['thumbnail'];
                $("#editArticleModal img[name='article_thumbnail_image']").attr('src',logo);

                var type = $("#typeSelector").find("option[selected='selected']").text();
                var group = $("#groupSelector").find("option[selected='selected']").text();
                $("#editArticleModal label[name='group_show']").text(type+'-'+group);
                $("#editArticleModal .modal-title").html('编辑文章：'+data['title']);
                $("#editArticleModal").modal(); 
            }
        });
}

function edit_content (id) {
    location.href = '__URL__/edit_content/id/' + id;
}

$(document).ready(function(){
    // 选择不同的库，显示相应的库存信息
    $("#typeSelector").change(function(){
        var url = "{:U('article/admin')}?type=" + $("#typeSelector").val();
        window.location.href = url;
    });

    $("#groupSelector").change(function(){
        var url = "{:U('article/admin')}?type={$type}&gid=" + $("#groupSelector").val();
        window.location.href = url;
    });

    $("#addArticleBtn").click(function(){
        $("#editArticleModal .modal-title").html('新建文章');
        $("#editArticleModal input").val(null);
        $("#editArticleModal button").val(null);
        $("#editArticleModal textarea").val(null);

        var type = $("#typeSelector").find("option[selected='selected']").text();
        var group = $("#groupSelector").find("option[selected='selected']").text();
        $("#editArticleModal label[name='group_show']").text(type+'-'+group);

        var group_id = $("#groupSelector").val();
        $("#editArticleModal input[name='article_group']").val(group_id);
        $("#editArticleModal").modal();  
    });
});
</script>

<section class="col-lg-12">
    <ul class="panel-tab">
        <li>
            <tagLib name="html" />
            <html:select name="type" title="name" options="typeList" selected="type" id="typeSelector"/>
            <html:select name="group" title="name" options="groupList" selected="groupId" id="groupSelector"/>
        </li>
        <a id="addArticleBtn" class="pull-right fa fa-plus create-btn">&nbsp;新建文章</a>
    </ul>
    <html:grid datasource="articleList" key="true" pk="id" show="title:文章标题,reference:来源,author:作者" style="table table-advance table-hover" action="true" actionList="edit_article:编辑,edit_content:内容,delete_article:删除" />
</section>

<!-- 新品编辑文章窗口 -->
<div class="modal" id="editArticleModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width:600px;">
            <form action="{:U('article/save')}" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">关闭</span>
                    </button>
                    <h4 class="modal-title" id="editArticleModalTitle">编辑文章</h4>
                </div>
                <div class="modal-body" style="overflow:auto;">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label name="group_show">文章分组(只读)</label>
                        </div>
                        <div class="form-group">
                            <label>文章标题</label>
                            <input type="text" name="article_title" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label>文章来源</label>
                            <input type="text" name="article_reference" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label>文章作者</label>
                            <input type="text" name="article_author" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label>选择图片</label>
                            <input type="file" name="article_thumbnail" class="form-control" /> 
                            <img src="" name="article_thumbnail_image" style="width:100px" />
                        </div>
                        <div class="c-group">
                            <label>文章简介</label>
                            <textarea class="form-control" name="article_bref" class="form-control"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="col-lg-12">
                        <input type="hidden" name="article_group" value="" />
                        <button type="submit" class="btn btn-danger" name="article_id" value="">保存</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>